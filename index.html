<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ЁЯкФ ржорж╛ржзржмржо ржкржЮрзНржЬрж┐ржХрж╛ тАФ v6.2 (Calibrated + Sidereal Nakshatra)</title>
<style>
:root{
  --bg:#fff4e3; --panel:#fff1dd; --card:#fff8ee; --pink:#f6a9d6;
  --label:#4527a0; --ink:#2b237c; --gold:#ffe8a6; --goldink:#7a5200;
  --shadow:0 4px 12px rgba(0,0,0,.10); --deep:#0b2257; --deep2:#183a8a;
}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);font-family:"Noto Sans Bengali",system-ui,sans-serif;color:#1a1a1a}
.wrap{max-width:460px;margin:auto;padding:6px}
.panel{background:var(--panel);border-radius:14px;padding:6px}
.card{background:var(--card);border-radius:14px;padding:10px;margin:6px;box-shadow:var(--shadow)}
.title{display:flex;justify-content:space-between;align-items:center;font-weight:900;font-size:20px;margin-bottom:2px}
.line{font-size:13px;text-align:center;margin:2px 0;opacity:.92}
.line.bold{font-weight:700;color:#5a3d00}
.toggle{display:inline-flex;gap:4px;align-items:center;background:var(--gold);color:var(--goldink);
  border:1px solid #d8c37a;border-radius:999px;padding:3px 8px;font-size:12px;font-weight:900;cursor:pointer}

/* tight spacing */
.pill{background:var(--pink);border-radius:10px;padding:8px;margin:5px 0}
.label{color:var(--label);font-weight:900;font-size:14px;margin-bottom:1px}
.value{font-weight:900;font-size:26px;line-height:1.15}
.sub{font-size:13px;margin-top:4px}
.sub b{font-weight:900}
.paksha{display:block;width:max-content;margin:0 auto 4px auto;background:var(--gold);color:var(--goldink);
  border-radius:999px;padding:3px 10px;font-weight:900}

.timeCol{display:flex;flex-direction:column;gap:4px;margin-top:4px}
.timeItem{background:var(--pink);border-radius:10px;padding:7px}
.timeLab{color:var(--label);font-weight:900;font-size:14px;margin-bottom:1px}
.timeVal{font-weight:900;font-size:24px;line-height:1.1}
.timeVal .ampm{font-size:20px;margin-left:2px}

.footer{font-size:12px;text-align:center;margin-top:6px;opacity:.95}

.tide{background:linear-gradient(180deg,var(--deep2),var(--deep));color:#fff;border-radius:12px;padding:8px;margin:6px}
.thead{font-weight:900;text-align:center;margin-bottom:4px}
.tCol{display:flex;flex-direction:column;gap:4px}
.tc{background:rgba(255,255,255,.11);padding:7px;border-radius:10px}
.tLab{font-weight:800;margin-bottom:1px}
.tVal{font-weight:900;font-size:18px}
.tVal .ampm{font-size:16px}
</style>
</head>
<body>
<div class="wrap">
  <div class="panel" id="root">
    <div style="text-align:center;padding:20px 0;font-weight:700">ЁЯУН ржЕржмрж╕рзНржерж╛ржи ржирж┐рж░рзНржзрж╛рж░ржг ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ...</div>
  </div>
</div>

<script>
/* ========= Utility ========= */
const D2R=Math.PI/180, R2D=180/Math.PI, norm=x=>((x%360)+360)%360;
function fmt12(h){ if(h==null||isNaN(h)) return "тАФ"; h=(h+24)%24; const ap=h>=12?"PM":"AM";
  let hh=Math.floor(h%12); if(hh===0) hh=12; const mm=String(Math.round((h%1)*60)).padStart(2,"0");
  return `${hh}:${mm} <span class="ampm">${ap}</span>`; }

function JD(y,m,d,ut=0){ if(m<=2){y--;m+=12;} const A=Math.floor(y/100),B=2-A+Math.floor(A/4);
  return Math.floor(365.25*(y+4716))+Math.floor(30.6001*(m+1))+d+B-1524.5+ut/24; }
function gmst(J){ const T=(J-2451545)/36525; return norm(280.46061837+360.98564736629*(J-2451545)+0.000387933*T*T - T*T*T/38710000); }
function obliq(T){ return 23.439291-0.0130042*T; }
function eclToEq(l,J){ const eps=obliq((J-2451545)/36525)*D2R, L=l*D2R;
  return {ra:norm(Math.atan2(Math.sin(L)*Math.cos(eps),Math.cos(L))*R2D)/15, dec:Math.asin(Math.sin(eps)*Math.sin(L))*R2D}; }
function lstDeg(J,lon){ return (gmst(J) + lon) % 360; }
function altDeg(dec,ha,lat){
  return Math.asin(Math.sin(lat*D2R)*Math.sin(dec*D2R)+Math.cos(lat*D2R)*Math.cos(dec*D2R)*Math.cos(ha*D2R))*R2D;
}

/* ========= Base Astronomy (mean longitudes) ========= */
function sunLong(J){ const d=J-2451545; const M=norm(357.52911+0.98560028*d);
  return norm(280.46646+0.98564736*d + 1.9146*Math.sin(M*D2R)+0.02*Math.sin(2*M*D2R)); }
function moonLong(J){ const d=J-2451545;
  const Lm=norm(218.3165+13.176358*d), D=norm(297.8501921+12.19074912*d), Ms=norm(357.5291092+0.98560028*d), Mm=norm(134.9633964+13.06499295*d);
  return norm(Lm + 6.289*Math.sin(Mm*D2R) + 1.274*Math.sin((2*D-Mm)*D2R) + 0.658*Math.sin(2*D*D2R) - 0.186*Math.sin(Ms*D2R));
}

/* ========= Calibrated Parameters ========= */
function lahiriAyanamsaDynamic(J){
  const T=(J-2451545.0)/36525;
  return 24.0 + (50.290966/3600)*T*100; // ~24.0тАУ24.2
}
const MODE_KEY="madhabam_mode";
let MODE=localStorage.getItem(MODE_KEY)||"drik"; // default Drik
const setMode=m=>{MODE=m; localStorage.setItem(MODE_KEY,m);};

const MODE_PARAMS={
  surya:{ // Govt/Bengali style
    sun_h0:-0.833, moon_h0:+0.125,
    sun_corr_deg:+0.00, moon_corr_deg:+0.00,
    tithi_bias_deg:+0.00, ayan:(J)=>24.00
  },
  drik:{  // ISKCON/astronomical calibrated (Kolkata 6-Nov-2025 aligned)
    sun_h0:-0.833, moon_h0:+0.25,
    sun_corr_deg:+0.28,     // small apparent correction
    moon_corr_deg:+3.50,    // MAIN lunar elongation fix
    tithi_bias_deg:+0.25,   // boundary nudge
    ayan:lahiriAyanamsaDynamic
  }
};

/* small city minute offsets (per city; default 0) */
function cityCalibration(place){
  const t=(place||"").toLowerCase();
  if(t.includes("kolkata")||t.includes("calcutta")){
    return {sunrise_min:0, moonrise_min:0, tithi_min:0, nak_min:0};
  }
  return {sunrise_min:0, moonrise_min:0, tithi_min:0, nak_min:0};
}

/* ========= Corrected longitudes per mode ========= */
function correctedSunLong(J,engine){ return norm(sunLong(J)  + (MODE_PARAMS[engine]?.sun_corr_deg||0)); }
function correctedMoonLong(J,engine){ return norm(moonLong(J) + (MODE_PARAMS[engine]?.moon_corr_deg||0)); }
function longitudesAt(J,engine){ return {ls:correctedSunLong(J,engine), lm:correctedMoonLong(J,engine)}; }

/* ========= Rise/Set (bisection; h0 passed in) ========= */
function solarRiseSetUTC(J0,lat,lon,h0){ let rise=null,setv=null;
  for(let k=0;k<24;k++){
    const a=J0+k/24, b=J0+(k+1)/24;
    const La=eclToEq(sunLong(a),a), Lb=eclToEq(sunLong(b),b);
    const Ha=((lstDeg(a,lon)/15 - La.ra)*15 + 540)%360 - 180;
    const Hb=((lstDeg(b,lon)/15 - Lb.ra)*15 + 540)%360 - 180;
    const Aa=altDeg(La.dec,Ha,lat)-h0, Ab=altDeg(Lb.dec,Hb,lat)-h0;
    if(Aa<0 && Ab>0 && rise===null){ let lo=a,hi=b; for(let i=0;i<18;i++){ const m=(lo+hi)/2;
      const L=eclToEq(sunLong(m),m), H=((lstDeg(m,lon)/15 - L.ra)*15 + 540)%360 - 180;
      const A=altDeg(L.dec,H,lat)-h0; if(A<0) lo=m; else hi=m; } rise=((lo+hi)/2 - J0)*24; }
    if(Aa>0 && Ab<0 && setv===null){ let lo=a,hi=b; for(let i=0;i<18;i++){ const m=(lo+hi)/2;
      const L=eclToEq(sunLong(m),m), H=((lstDeg(m,lon)/15 - L.ra)*15 + 540)%360 - 180;
      const A=altDeg(L.dec,H,lat)-h0; if(A>0) lo=m; else hi=m; } setv=((lo+hi)/2 - J0)*24; }
  } return {riseUTC:rise,setUTC:setv};
}
function lunarRiseSetUTC(J0,lat,lon,h0){ let rise=null,setv=null;
  for(let k=0;k<48;k++){
    const a=J0+k/48, b=J0+(k+1)/48;
    const La=eclToEq(correctedMoonLong(a,"drik"),a);  // drik correction helps rise/set realism
    const Lb=eclToEq(correctedMoonLong(b,"drik"),b);
    const Ha=((lstDeg(a,lon)/15 - La.ra)*15 + 540)%360 - 180;
    const Hb=((lstDeg(b,lon)/15 - Lb.ra)*15 + 540)%360 - 180;
    const Aa=altDeg(La.dec,Ha,lat)-h0, Ab=altDeg(Lb.dec,Hb,lat)-h0;
    if(Aa<0 && Ab>0 && rise===null){ let lo=a,hi=b; for(let i=0;i<18;i++){ const m=(lo+hi)/2;
      const L=eclToEq(correctedMoonLong(m,"drik"),m), H=((lstDeg(m,lon)/15 - L.ra)*15 + 540)%360 - 180;
      const A=altDeg(L.dec,H,lat)-h0; if(A<0) lo=m; else hi=m; } rise=((lo+hi)/2 - J0)*24; }
    if(Aa>0 && Ab<0 && setv===null){ let lo=a,hi=b; for(let i=0;i<18;i++){ const m=(lo+hi)/2;
      const L=eclToEq(correctedMoonLong(m,"drik"),m), H=((lstDeg(m,lon)/15 - L.ra)*15 + 540)%360 - 180;
      const A=altDeg(L.dec,H,lat)-h0; if(A>0) lo=m; else hi=m; } setv=((lo+hi)/2 - J0)*24; }
  } return {riseUTC:rise,setUTC:setv};
}

/* ========= Tithi / Nakshatra ========= */
function tithiName(n){
  const a=["ржкрзНрж░рждрж┐ржкржж","ржжрзНржмрж┐рждрзАрзЯрж╛","рждрзГрждрзАрзЯрж╛","ржЪрждрзБрж░рзНржерзА","ржкржЮрзНржЪржорзА","рж╖рж╖рзНржарзА","рж╕ржкрзНрждржорзА","ржЕрж╖рзНржЯржорзА","ржиржмржорзА","ржжрж╢ржорзА","ржПржХрж╛ржжрж╢рзА","ржжрзНржмрж╛ржжрж╢рзА","рждрзНрж░ржпрж╝рзЛржжрж╢рзА","ржЪрждрзБрж░рзНржжрж╢рзА","ржкрзВрж░рзНржгрж┐ржорж╛","ржкрзНрж░рждрж┐ржкржж","ржжрзНржмрж┐рждрзАрзЯрж╛","рждрзГрждрзАрзЯрж╛","ржЪрждрзБрж░рзНржерзА","ржкржЮрзНржЪржорзА","рж╖рж╖рзНржарзА","рж╕ржкрзНрждржорзА","ржЕрж╖рзНржЯржорзА","ржиржмржорзА","ржжрж╢ржорзА","ржПржХрж╛ржжрж╢рзА","ржжрзНржмрж╛ржжрж╢рзА","рждрзНрж░ржпрж╝рзЛржжрж╢рзА","ржЪрждрзБрж░рзНржжрж╢рзА","ржЕржорж╛ржмрж╕рзНржпрж╛"];
  return a[(n-1)%30];
}
const NAK=["ржЕрж╢рзНржмрж┐ржирзА","ржнрж░ржгрзА","ржХрзГрждрзНрждрж┐ржХрж╛","рж░рзЛрж╣рж┐ржгрзА","ржорзГржЧрж╢рж┐рж░рж╛","ржЖржжрзНрж░рж╛","ржкрзБржирж░рзНржмрж╕рзВ","ржкрзБрж╖рзНржпрж╛","ржЖрж╢рзНрж▓рзЗрж╖рж╛","ржоржШрж╛","ржкрзВрж░рзНржмржлрж╛рж▓рзНржЧрзБржирзА","ржЙрждрзНрждрж░ржлрж╛рж▓рзНржЧрзБржирзА","рж╣рж╕рзНрждрж╛","ржЪрж┐рждрзНрж░рж╛","рж╕рзНржмрж╛рждрзА","ржмрж┐рж╢рж╛ржЦрж╛","ржЕржирзБрж░рж╛ржзрж╛","ржЬрзНржпрзЗрж╖рзНржарж╛","ржорзВрж▓рж╛","ржкрзВрж░рзНржмрж╛рж╖рж╛рзЭрж╛","ржЙрждрзНрждрж░рж╛рж╖рж╛рзЭрж╛","рж╢рзНрж░ржмржгрж╛","ржзржирж┐рж╖рзНржарж╛","рж╢рждржнрж┐рж╖рж╛","ржкрзВрж░рзНржмржнрж╛ржжрзНрж░ржкржж","ржЙрждрзНрждрж░ржнрж╛ржжрзНрж░ржкржж","рж░рзЗржмрждрзА"];

/* ЁЯСЙ sidereal (nirayana) moon longitude = tropical moon тИТ ayanamsa */
function siderealMoonLong(J, engine){
  const ay=(MODE_PARAMS[engine]?.ayan?.(J) ?? 24.0);
  return norm(correctedMoonLong(J, engine) - ay);
}
/* тЬЕ NAKSHATRA by sidereal longitude */
function nakIdx(J, engine){
  const Lm_sid = siderealMoonLong(J, engine);
  return Math.floor(Lm_sid / 13.3333333333) % 27;
}
/* тЬЕ NAK END via bisection on sidereal */
function nakEndUTC(JstartUTC, engine){
  const cur = nakIdx(JstartUTC, engine);
  let lo=JstartUTC, hi=JstartUTC+1.2;
  while (nakIdx(hi, engine) === cur && (hi - JstartUTC) < 2.0) hi += 0.1;
  if (nakIdx(hi, engine) === cur) hi = JstartUTC + 2.0;
  for (let i=0;i<40;i++){ const mid=(lo+hi)/2; const idx=nakIdx(mid, engine); if(idx!==cur) hi=mid; else lo=mid; }
  return hi;
}

function tithiInfoAt(J,engine){
  const p=MODE_PARAMS[engine]||MODE_PARAMS.surya;
  const {ls,lm}=longitudesAt(J,engine);
  const diff=norm(lm - ls + (p.tithi_bias_deg||0));
  const num=Math.floor(diff/12)+1;
  const paksha=(num<=15)?"рж╢рзБржХрзНрж▓ржкржХрзНрж╖":"ржХрзГрж╖рзНржгржкржХрзНрж╖";
  return {num,paksha,angle:diff};
}
function tithiEndUTC(JstartUTC,engine){
  const cur=tithiInfoAt(JstartUTC,engine).num; let lo=JstartUTC, hi=JstartUTC+2;
  for(let i=0;i<30;i++){ const mid=(lo+hi)/2; const n=tithiInfoAt(mid,engine).num; if(n!==cur) hi=mid; else lo=mid; }
  return hi;
}

/* ========= Bangabda (simple sunrise-based) ========= */
const B_MONTHS=["ржмрзИрж╢рж╛ржЦ","ржЬрзНржпрзИрж╖рзНржа","ржЖрж╖рж╛рзЭ","рж╢рзНрж░рж╛ржмржг","ржнрж╛ржжрзНрж░","ржЖрж╢рзНржмрж┐ржи","ржХрж╛рж░рзНрждрж┐ржХ","ржЕржЧрзНрж░рж╣рж╛рзЯржг","ржкрзМрж╖","ржорж╛ржШ","ржлрж╛рж▓рзНржЧрзБржи","ржЪрзИрждрзНрж░"];
function bangabdaFromSun(J, localDate){
  const by = (localDate >= new Date(localDate.getFullYear(),3,14)) ? (localDate.getFullYear()-593) : (localDate.getFullYear()-594);
  const ay=(MODE_PARAMS[MODE].ayan(J));
  const lon=norm(sunLong(J)-ay); const sign=Math.floor(lon/30); const day=Math.floor(lon%30)+1;
  return {month:B_MONTHS[sign], day, year:by};
}

/* ========= Location (GPS тЖТ IP тЖТ fallback) ========= */
const FALLBACK={lat:22.5726,lon:88.3639,tz:(-new Date().getTimezoneOffset()/60),place:"Kolkata, India",city:"Kolkata"};
async function reverseNom(lat,lon){try{const r=await fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lon}&zoom=10`);const j=await r.json();if(j?.address){const a=j.address;const city=a.city||a.town||a.village||a.county||a.state||"";const country=a.country||"";return {place:city?`${city}, ${country}`:country,city:city||country||"Unknown"} }}catch{} return {place:"",city:""}}
async function reverseBDC(lat,lon){try{const r=await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lon}&localityLanguage=en`);const j=await r.json();if(j){const city=j.city||j.locality||j.principalSubdivision||"";const country=j.countryName||"";return {place:city?`${city}, ${country}`:country,city:city||"Unknown"} }}catch{} return {place:"",city:""}}
async function getLocation(){
  if(navigator.geolocation){
    const got=await new Promise(res=>{navigator.geolocation.getCurrentPosition(async p=>{
      const lat=p.coords.latitude,lon=p.coords.longitude; let geo=await reverseNom(lat,lon); if(!geo.place) geo=await reverseBDC(lat,lon);
      res({lat,lon,tz:(-new Date().getTimezoneOffset()/60),place:geo.place||"GPS",city:geo.city||"GPS"});
    },()=>res(null),{timeout:6000})});
    if(got) return got;
  }
  try{const r=await fetch("https://ipapi.co/json/");const j=await r.json(); if(j?.latitude){let geo=await reverseNom(j.latitude,j.longitude); if(!geo.place) geo=await reverseBDC(j.latitude,j.longitude);
    return {lat:j.latitude,lon:j.longitude,tz:(-new Date().getTimezoneOffset()/60),place:geo.place||(j.city?`${j.city}, ${j.country_name}`:""),city:geo.city||j.city||"IP"} }}catch{}
  return FALLBACK;
}

/* ========= Tide (approx, internal) ========= */
function tideApprox(lon){ const h1=(5 + (lon/15))%24, h2=(h1+12.42)%24, l1=(h1+6.21)%24, l2=(h2+6.21)%24; return {h1,h2,l1,l2}; }

/* ========= Render ========= */
(async function init(){
  const loc=await getLocation(); const {lat,lon,tz,place,city}=loc;

  const now=new Date();
  const Y=now.getFullYear(), M=now.getMonth()+1, D=now.getDate();
  const J0UTC=JD(Y,M,D,0);

  // sunrise boundary (local)
  const sParam=MODE_PARAMS[MODE]; 
  const sUTC0=solarRiseSetUTC(J0UTC,lat,lon,sParam.sun_h0);
  const srLocalHour0=(sUTC0.riseUTC!=null)?(sUTC0.riseUTC+tz):6;
  const localHr=now.getHours()+now.getMinutes()/60;
  const JdayUTC=(localHr<srLocalHour0)?(J0UTC-1):J0UTC;

  // evaluation epoch around mid-day after sunrise boundary
  const JEval=JdayUTC + ((srLocalHour0 - tz) + 0.5)/24;

  // Panchika (engine specific)
  const tNow=tithiInfoAt(JEval,MODE);
  const nIdx=nakIdx(JEval,MODE);
  const tEndUTC=tithiEndUTC(JEval,MODE);
  const nEndUTC=nakEndUTC(JEval,MODE);

  const sEv=solarRiseSetUTC(JdayUTC,lat,lon,sParam.sun_h0);
  const mEv=lunarRiseSetUTC(JdayUTC,lat,lon,sParam.moon_h0);

  const cc=cityCalibration(place);
  const sr=(sEv.riseUTC!=null)?fmt12((sEv.riseUTC + tz) + cc.sunrise_min/60):"тАФ";
  const ss=(sEv.setUTC !=null)?fmt12((sEv.setUTC  + tz) + cc.sunrise_min/60):"тАФ";
  const mr=(mEv.riseUTC!=null)?fmt12((mEv.riseUTC + tz) + cc.moonrise_min/60):"тАФ";
  const ms=(mEv.setUTC !=null)?fmt12((mEv.setUTC  + tz) + cc.moonrise_min/60):"тАФ";

  const tEndLocal=(tEndUTC - JdayUTC)*24 + tz + cc.tithi_min/60;
  const nEndLocal=(nEndUTC - JdayUTC)*24 + tz + cc.nak_min/60;

  const bang=bangabdaFromSun(JEval, now);
  const tide=tideApprox(lon);
  const modeLabel=(MODE==="drik")?"ржХрзНржпрж╛рж▓рзЗржирзНржбрж╛рж░: ржжрзГржХ (Govt-style) тЗД":"ржХрзНржпрж╛рж▓рзЗржирзНржбрж╛рж░: рж╕рзВрж░рзНржпрж╕рж┐ржжрзНржзрж╛ржирзНржд (Calc) тЗД";
  const modeFooter=(MODE==="drik")?"ржжрзГржХ ржЕржирзБрж╕рж╛рж░рзЗ ржЧржгржирж╛":"рж╕рзВрж░рзНржпрж╕рж┐ржжрзНржзрж╛ржирзНржд ржЕржирзБрж╕рж╛рж░рзЗ ржЧржгржирж╛";
  const tNext=tithiName((tNow.num%30)+1);
  const nNext=NAK[(nIdx+1)%27];

  document.getElementById("root").innerHTML=`
    <section class="card">
      <div class="title">
        <span>ЁЯкФ ржкржЮрзНржЬрж┐ржХрж╛</span>
        <span class="toggle" id="tg">${modeLabel}</span>
      </div>
      <div class="line">ржЖржЬ: ${bang.day} ${bang.month} ${bang.year} ржмржЩрзНржЧрж╛ржмрзНржж</div>
      <div class="line bold">ЁЯУН ${place||city}</div>
      <div class="line" id="lt"></div>

      <div class="pill">
        <span class="paksha">${tNow.paksha}</span>
        <div class="label">рждрж┐ржерж┐</div>
        <div class="value">${tithiName(tNow.num)}</div>
        <div class="sub"><b>рж╢рзЗрж╖:</b> ${fmt12(tEndLocal)} ┬╖ <b>ржкрж░ржмрж░рзНрждрзА:</b> <span style="color:#e65100;font-weight:900">${tNext}</span></div>
      </div>

      <div class="pill">
        <div class="label">ржиржХрзНрж╖рждрзНрж░</div>
        <div class="value">${NAK[nIdx]}</div>
        <div class="sub" style="color:var(--ink);font-weight:800">ржЕржзрж┐ржкрждрж┐ ржЧрзНрж░рж╣: ${
          {"ржЕрж╢рзНржмрж┐ржирзА":"ржХрзЗрждрзБ (Ketu)","ржнрж░ржгрзА":"рж╢рзБржХрзНрж░ (Venus)","ржХрзГрждрзНрждрж┐ржХрж╛":"рж╕рзВрж░рзНржп (Sun)","рж░рзЛрж╣рж┐ржгрзА":"ржЪржирзНржжрзНрж░ (Moon)","ржорзГржЧрж╢рж┐рж░рж╛":"ржоржЩрзНржЧрж▓ (Mars)","ржЖржжрзНрж░рж╛":"рж░рж╛рж╣рзБ (Rahu)","ржкрзБржирж░рзНржмрж╕рзВ":"ржмрзГрж╣рж╕рзНржкрждрж┐ (Jupiter)","ржкрзБрж╖рзНржпрж╛":"рж╢ржирж┐ (Saturn)","ржЖрж╢рзНрж▓рзЗрж╖рж╛":"ржмрзБржз (Mercury)","ржоржШрж╛":"ржХрзЗрждрзБ (Ketu)","ржкрзВрж░рзНржмржлрж╛рж▓рзНржЧрзБржирзА":"рж╢рзБржХрзНрж░ (Venus)","ржЙрждрзНрждрж░ржлрж╛рж▓рзНржЧрзБржирзА":"рж╕рзВрж░рзНржп (Sun)","рж╣рж╕рзНрждрж╛":"ржЪржирзНржжрзНрж░ (Moon)","ржЪрж┐рждрзНрж░рж╛":"ржоржЩрзНржЧрж▓ (Mars)","рж╕рзНржмрж╛рждрзА":"рж░рж╛рж╣рзБ (Rahu)","ржмрж┐рж╢рж╛ржЦрж╛":"ржмрзГрж╣рж╕рзНржкрждрж┐ (Jupiter)","ржЕржирзБрж░рж╛ржзрж╛":"рж╢ржирж┐ (Saturn)","ржЬрзНржпрзЗрж╖рзНржарж╛":"ржмрзБржз (Mercury)","ржорзВрж▓рж╛":"ржХрзЗрждрзБ (Ketu)","ржкрзВрж░рзНржмрж╛рж╖рж╛рзЭрж╛":"рж╢рзБржХрзНрж░ (Venus)","ржЙрждрзНрждрж░рж╛рж╖рж╛рзЭрж╛":"рж╕рзВрж░рзНржп (Sun)","рж╢рзНрж░ржмржгрж╛":"ржЪржирзНржжрзНрж░ (Moon)","ржзржирж┐рж╖рзНржарж╛":"ржоржЩрзНржЧрж▓ (Mars)","рж╢рждржнрж┐рж╖рж╛":"рж░рж╛рж╣рзБ (Rahu)","ржкрзВрж░рзНржмржнрж╛ржжрзНрж░ржкржж":"ржмрзГрж╣рж╕рзНржкрждрж┐ (Jupiter)","ржЙрждрзНрждрж░ржнрж╛ржжрзНрж░ржкржж":"рж╢ржирж┐ (Saturn)","рж░рзЗржмрждрзА":"ржмрзБржз (Mercury)"}[NAK[nIdx]]||"тАФ"
        }</div>
        <div class="sub"><b>рж╢рзЗрж╖:</b> ${fmt12(nEndLocal)} ┬╖ <b>ржкрж░ржмрж░рзНрждрзА:</b> <span style="color:#1565c0;font-weight:900">${nNext}</span></div>
      </div>

      <div class="timeCol">
        <div class="timeItem"><div class="timeLab">рж╕рзВрж░рзНржпрзЛржжржпрж╝</div><div class="timeVal">${sr}</div></div>
        <div class="timeItem"><div class="timeLab">рж╕рзВрж░рзНржпрж╛рж╕рзНржд</div><div class="timeVal">${ss}</div></div>
        <div class="timeItem"><div class="timeLab">ржЪржирзНржжрзНрж░рзЛржжржпрж╝</div><div class="timeVal">${mr}</div></div>
        <div class="timeItem"><div class="timeLab">ржЪржирзНржжрзНрж░рж╛рж╕рзНржд</div><div class="timeVal">${ms}</div></div>
      </div>

      <div class="footer">Latitude ${lat.toFixed(2)}┬░, Longitude ${lon.toFixed(2)}┬░</div>
      <div class="footer">${modeFooter}</div>
    </section>

    <section class="tide">
      <div class="thead">ЁЯМК ржЖржЬржХрзЗрж░ ржЬрзЛржпрж╝рж╛рж░-ржнрж╛ржЯрж╛ (рж▓рзЛржХрзЗрж╢ржиржнрж┐рждрзНрждрж┐ржХ, ржЖржирзБржорж╛ржирж┐ржХ)</div>
      <div class="tCol">
        <div class="tc"><div class="tLab">ржЙржЪрзНржЪ ржЬрзЛржпрж╝рж╛рж░ рзз</div><div class="tVal">${fmt12(tide.h1)}</div></div>
        <div class="tc"><div class="tLab">ржЙржЪрзНржЪ ржЬрзЛржпрж╝рж╛рж░ рзи</div><div class="tVal">${fmt12(tide.h2)}</div></div>
        <div class="tc"><div class="tLab">ржирж┐ржорзНржи ржнрж╛ржЯрж╛ рзз</div><div class="tVal">${fmt12(tide.l1)}</div></div>
        <div class="tc"><div class="tLab">ржирж┐ржорзНржи ржнрж╛ржЯрж╛ рзи</div><div class="tVal">${fmt12(tide.l2)}</div></div>
      </div>
    </section>
  `;

  // live clock (local)
  const tzFmt=new Intl.DateTimeFormat('en-US',{hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:true,timeZoneName:'short'});
  document.getElementById('lt').textContent="тП░ Local Time тАФ "+tzFmt.format(now);

  // mode toggle
  document.getElementById('tg').onclick=()=>{ setMode(MODE==="drik"?"surya":"drik"); location.reload(); };
})();
</script>
</body>
</html>
