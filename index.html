<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ЁЯкФ ржорж╛ржзржмржо ржкржЮрзНржЬрж┐ржХрж╛ тАФ Surya-Siddhanta vC5.3</title>
<style>
:root{--bg:#fff4e3;--card:#fff8ee;--pink:#f6a9d6;--red:#c62828;--label:#4527a0;--shadow:0 6px 16px rgba(0,0,0,.12);--ink:#2b237c}
body{margin:0;background:var(--bg);font-family:"Noto Sans Bengali","Noto Serif Bengali",system-ui,sans-serif;color:#1a1a1a}
.wrap{max-width:420px;margin:auto;padding:12px}
.card{background:var(--card);border-radius:18px;padding:14px;margin:10px;box-shadow:var(--shadow)}
.title{text-align:center;font-weight:900;font-size:22px;margin-bottom:6px}
.small{font-size:13px;opacity:.85;text-align:center;margin-bottom:6px}
.grid{display:grid;gap:10px}
.grid-2{grid-template-columns:1fr 1fr}
.pill{background:var(--pink);border-radius:12px;padding:10px}
.label{color:var(--label);font-weight:900;font-size:15px}
.value{font-weight:900;font-size:26px;line-height:1.2;margin-top:2px}
.sub{font-size:14px;margin-top:2px}
.sub b{font-weight:900}
.starlord{font-size:14px;margin-top:4px;color:var(--ink);font-weight:800}
.badge{display:inline-block;margin-top:6px;font-size:13px;padding:4px 8px;border-radius:999px;background:#ffe8a6;color:#7a5200;font-weight:900}
.footer{font-size:13px;text-align:center;margin-top:8px;opacity:.85}
.tide{background:linear-gradient(180deg,#183a8a,#0b2257);color:#fff;border-radius:16px;padding:12px;margin:10px}
.tgrid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.tcell{background:rgba(255,255,255,.1);padding:10px;border-radius:10px;text-align:center}
.tlab{font-weight:800}
.tval{font-weight:900;font-size:20px}
</style>
</head>
<body>
<div class="wrap" id="root">
  <div style="text-align:center;margin-top:40px;font-weight:700">ЁЯУН ржЕржмрж╕рзНржерж╛ржи ржирж┐рж░рзНржзрж╛рж░ржг ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ...</div>
</div>

<script>
/* ========= Location (GPS тЖТ IP тЖТ Kolkata) ========= */
const FALLBACK = {lat:22.5726, lon:88.3639, tz:(-new Date().getTimezoneOffset()/60), city:"ржХрж▓ржХрж╛рждрж╛"};
function getLocation(){
  return new Promise(res=>{
    if(navigator.geolocation){
      navigator.geolocation.getCurrentPosition(p=>{
        res({lat:p.coords.latitude,lon:p.coords.longitude, tz:(-new Date().getTimezoneOffset()/60), city:"GPS"});
      }, async ()=>{
        try{
          const r=await fetch("https://ipapi.co/json/");
          const j=await r.json();
          if(j && j.latitude) res({lat:j.latitude,lon:j.longitude,tz:(-new Date().getTimezoneOffset()/60),city:j.city||"IP"});
          else res(FALLBACK);
        }catch{res(FALLBACK);}
      }, {timeout:6000});
    } else res(FALLBACK);
  });
}

/* ========= Astro Core (Surya-Siddhanta style) ========= */
const D2R=Math.PI/180,R2D=180/Math.PI; const norm=x=>(x%360+360)%360;
function JD(y,m,d,ut=0){ if(m<=2){y--;m+=12;} const A=Math.floor(y/100),B=2-A+Math.floor(A/4);
  return Math.floor(365.25*(y+4716))+Math.floor(30.6001*(m+1))+d+B-1524.5+ut/24; }
function obliq(T){ return 23.439291-0.0130042*T; }
function gmst(J){ const T=(J-2451545)/36525;
  return norm(280.46061837+360.98564736629*(J-2451545)+0.000387933*T*T - T*T*T/38710000); }
function sunLong(J){ // tropical, deg
  const d=J-2451545; const M=norm(357.52911+0.98560028*d);
  return norm(280.46646+0.98564736*d + 1.9146*Math.sin(M*D2R)+0.02*Math.sin(2*M*D2R));
}
function moonLong(J){ const d=J-2451545;
  const Lm=norm(218.3165+13.176358*d), D=norm(297.8501921+12.19074912*d),
        Ms=norm(357.5291092+0.98560028*d), Mm=norm(134.9633964+13.06499295*d);
  return norm(Lm + 6.289*Math.sin(Mm*D2R) + 1.274*Math.sin((2*D-Mm)*D2R)
                 + 0.658*Math.sin(2*D*D2R) - 0.186*Math.sin(Ms*D2R));
}
function eclToEq(l,J){ const eps=obliq((J-2451545)/36525)*D2R, L=l*D2R;
  return { ra: norm(Math.atan2(Math.sin(L)*Math.cos(eps),Math.cos(L))*R2D)/15,
           dec: Math.asin(Math.sin(eps)*Math.sin(L))*R2D };
}
function hourAngle(J,ra,lat,lon,tz){ const lst=(gmst(J)/15 + tz + lon/15); let H=(lst-ra)*15;
  return ((H+540)%360)-180; }
function altitude(dec,H,lat){ return Math.asin(Math.sin(lat*D2R)*Math.sin(dec*D2R)+Math.cos(lat*D2R)*Math.cos(dec*D2R)*Math.cos(H*D2R))*R2D; }
function riseSet(body,J0,lat,lon,tz){ let rise=null,setv=null;
  for(let h=-14;h<14;h++){
    const J1=J0+(h-0.5-tz)/24, J2=J0+(h+0.5-tz)/24;
    const L1=(body==="sun")?sunLong(J1):moonLong(J1), L2=(body==="sun")?sunLong(J2):moonLong(J2);
    const q1=eclToEq(L1,J1), q2=eclToEq(L2,J2);
    const a1=altitude(q1.dec, hourAngle(J1,q1.ra,lat,lon,tz), lat);
    const a2=altitude(q2.dec, hourAngle(J2,q2.ra,lat,lon,tz), lat);
    if(a1<0 && a2>0 && rise===null) { const t=-a1/(a2-a1); rise=(h-0.5)+t; }
    if(a1>0 && a2<0 && setv===null) { const t= a1/(a1-a2); setv=(h-0.5)+t; }
  }
  return {rise,set:setv};
}
const to12=h=>{ if(h==null||isNaN(h))return "тАФ"; h=(h+24)%24; const ap=h>=12?"PM":"AM";
  let hh=Math.floor(h%12); if(hh===0)hh=12; const mm=Math.round((h%1)*60);
  return `${hh}:${String(mm).padStart(2,"0")} ${ap}`; };

/* ========= Tithi / Nakshatra / Paksha ========= */
function tithiName(n){ // correct Bengali names
  const a=["ржкрзНрж░рждрж┐ржкржж","ржжрзНржмрж┐рждрзАрзЯрж╛","рждрзГрждрзАрзЯрж╛","ржЪрждрзБрж░рзНржерзА","ржкржЮрзНржЪржорзА","рж╖рж╖рзНржарзА","рж╕ржкрзНрждржорзА","ржЕрж╖рзНржЯржорзА","ржиржмржорзА","ржжрж╢ржорзА","ржПржХрж╛ржжрж╢рзА","ржжрзНржмрж╛ржжрж╢рзА","рждрзНрж░ржпрж╝рзЛржжрж╢рзА","ржЪрждрзБрж░рзНржжрж╢рзА","ржкрзВрж░рзНржгрж┐ржорж╛","ржкрзНрж░рждрж┐ржкржж","ржжрзНржмрж┐рждрзАрзЯрж╛","рждрзГрждрзАрзЯрж╛","ржЪрждрзБрж░рзНржерзА","ржкржЮрзНржЪржорзА","рж╖рж╖рзНржарзА","рж╕ржкрзНрждржорзА","ржЕрж╖рзНржЯржорзА","ржиржмржорзА","ржжрж╢ржорзА","ржПржХрж╛ржжрж╢рзА","ржжрзНржмрж╛ржжрж╢рзА","рждрзНрж░ржпрж╝рзЛржжрж╢рзА","ржЪрждрзБрж░рзНржжрж╢рзА","ржЕржорж╛ржмрж╕рзНржпрж╛"];
  return a[(n-1)%30];
}
const NAK = [
 "ржЕрж╢рзНржмрж┐ржирзА","ржнрж░ржгрзА","ржХрзГрждрзНрждрж┐ржХрж╛","рж░рзЛрж╣рж┐ржгрзА","ржорзГржЧрж╢рж┐рж░рж╛","ржЖржжрзНрж░рж╛","ржкрзБржирж░рзНржмрж╕рзВ","ржкрзБрж╖рзНржпрж╛","ржЖрж╢рзНрж▓рзЗрж╖рж╛",
 "ржоржШрж╛","ржкрзВрж░рзНржмржлрж╛рж▓рзНржЧрзБржирзА","ржЙрждрзНрждрж░ржлрж╛рж▓рзНржЧрзБржирзА","рж╣рж╕рзНрждрж╛","ржЪрж┐рждрзНрж░рж╛","рж╕рзНржмрж╛рждрзА","ржмрж┐рж╢рж╛ржЦрж╛","ржЕржирзБрж░рж╛ржзрж╛",
 "ржЬрзНржпрзЗрж╖рзНржарж╛","ржорзВрж▓рж╛","ржкрзВрж░рзНржмрж╛рж╖рж╛рзЭрж╛","ржЙрждрзНрждрж░рж╛рж╖рж╛рзЭрж╛","рж╢рзНрж░ржмржгрж╛","ржзржирж┐рж╖рзНржарж╛","рж╢рждржнрж┐рж╖рж╛","ржкрзВрж░рзНржмржнрж╛ржжрзНрж░ржкржж",
 "ржЙрждрзНрждрж░ржнрж╛ржжрзНрж░ржкржж","рж░рзЗржмрждрзА"
];
const LORD = { // Star Lords
 "ржЕрж╢рзНржмрж┐ржирзА":"ржХрзЗрждрзБ (Ketu)","ржнрж░ржгрзА":"рж╢рзБржХрзНрж░ (Venus)","ржХрзГрждрзНрждрж┐ржХрж╛":"рж╕рзВрж░рзНржп (Sun)","рж░рзЛрж╣рж┐ржгрзА":"ржЪржирзНржжрзНрж░ (Moon)",
 "ржорзГржЧрж╢рж┐рж░рж╛":"ржоржЩрзНржЧрж▓ (Mars)","ржЖржжрзНрж░рж╛":"рж░рж╛рж╣рзБ (Rahu)","ржкрзБржирж░рзНржмрж╕рзВ":"ржмрзГрж╣рж╕рзНржкрждрж┐ (Jupiter)","ржкрзБрж╖рзНржпрж╛":"рж╢ржирж┐ (Saturn)",
 "ржЖрж╢рзНрж▓рзЗрж╖рж╛":"ржмрзБржз (Mercury)","ржоржШрж╛":"ржХрзЗрждрзБ (Ketu)","ржкрзВрж░рзНржмржлрж╛рж▓рзНржЧрзБржирзА":"рж╢рзБржХрзНрж░ (Venus)","ржЙрждрзНрждрж░ржлрж╛рж▓рзНржЧрзБржирзА":"рж╕рзВрж░рзНржп (Sun)",
 "рж╣рж╕рзНрждрж╛":"ржЪржирзНржжрзНрж░ (Moon)","ржЪрж┐рждрзНрж░рж╛":"ржоржЩрзНржЧрж▓ (Mars)","рж╕рзНржмрж╛рждрзА":"рж░рж╛рж╣рзБ (Rahu)","ржмрж┐рж╢рж╛ржЦрж╛":"ржмрзГрж╣рж╕рзНржкрждрж┐ (Jupiter)",
 "ржЕржирзБрж░рж╛ржзрж╛":"рж╢ржирж┐ (Saturn)","ржЬрзНржпрзЗрж╖рзНржарж╛":"ржмрзБржз (Mercury)","ржорзВрж▓рж╛":"ржХрзЗрждрзБ (Ketu)","ржкрзВрж░рзНржмрж╛рж╖рж╛рзЭрж╛":"рж╢рзБржХрзНрж░ (Venus)",
 "ржЙрждрзНрждрж░рж╛рж╖рж╛рзЭрж╛":"рж╕рзВрж░рзНржп (Sun)","рж╢рзНрж░ржмржгрж╛":"ржЪржирзНржжрзНрж░ (Moon)","ржзржирж┐рж╖рзНржарж╛":"ржоржЩрзНржЧрж▓ (Mars)","рж╢рждржнрж┐рж╖рж╛":"рж░рж╛рж╣рзБ (Rahu)",
 "ржкрзВрж░рзНржмржнрж╛ржжрзНрж░ржкржж":"ржмрзГрж╣рж╕рзНржкрждрж┐ (Jupiter)","ржЙрждрзНрждрж░ржнрж╛ржжрзНрж░ржкржж":"рж╢ржирж┐ (Saturn)","рж░рзЗржмрждрзА":"ржмрзБржз (Mercury)"
};
function tithiInfo(J){ const ls=sunLong(J), lm=moonLong(J);
  const diff=norm(lm-ls); const num=Math.floor(diff/12)+1; const rem=(diff%12)/12;
  const paksha=(num<=15)?"рж╢рзБржХрзНрж▓ржкржХрзНрж╖":"ржХрзГрж╖рзНржгржкржХрзНрж╖"; return {num,rem,paksha,ls,lm}; }
function nakInfo(J){ const lm=moonLong(J), step=(13 + 20/60);
  const idx=Math.floor(lm/step); const frac=(lm%step)/step;
  return {idx,frac,name:NAK[idx]}; }

/* ========= Bangabda (sidereal solar) ========= */
// Lahiri ayanamsa (rough) тАФ good enough for month/day resolution
function lahiriAyanamsa(J){ // degrees
  const T=(J-2451545)/36525; return 24.0 + 0.0*T; // ~24┬░ near 2025; simple
}
const B_MONTHS=["ржмрзИрж╢рж╛ржЦ","ржЬрзНржпрзИрж╖рзНржа","ржЖрж╖рж╛рзЭ","рж╢рзНрж░рж╛ржмржг","ржнрж╛ржжрзНрж░","ржЖрж╢рзНржмрж┐ржи","ржХрж╛рж░рзНрждрж┐ржХ","ржЕржЧрзНрж░рж╣рж╛рзЯржг","ржкрзМрж╖","ржорж╛ржШ","ржлрж╛рж▓рзНржЧрзБржи","ржЪрзИрждрзНрж░"];
function bangabdaFromSun(J, tz, nowLocal){
  // Sunrise-based date anchor handled outside: J comes for the 'panchika day'
  const ay = lahiriAyanamsa(J);
  const lon = norm(sunLong(J) - ay); // nirayana longitude 0..360
  const sign = Math.floor(lon/30); // 0..11 (Mesha..Meena) тЖТ ржмрзИрж╢рж╛ржЦ..ржЪрзИрждрзНрж░
  const dayInMonth = Math.floor(lon%30)+1;
  // Year roll at Poila Boishakh (when sign turns to 0)
  const g = new Date(nowLocal); // local civil now
  const poila = new Date(g.getFullYear(),3,14); // Apr 14 (WB)
  const byear = (nowLocal >= poila) ? (g.getFullYear()-593) : (g.getFullYear()-594);
  return {month:B_MONTHS[sign], day:dayInMonth, year:byear};
}

/* ========= Render ========= */
const root=()=>document.getElementById("root");
function rowTime(label,id){ return `<div class="pill"><div class="label">${label}</div><div class="value" id="${id}">тАФ</div></div>`; }
function setText(id,v){ const el=document.getElementById(id); if(el) el.textContent=v; }

async function init(){
  const loc = await getLocation();
  const {lat,lon,tz,city}=loc;

  // Compute for local 'panchika day' (sunrise-based)
  const now = new Date();
  const Y=now.getFullYear(), M=now.getMonth()+1, D=now.getDate();
  const J0 = JD(Y,M,D,0); // 0h UTC
  const rsSun = riseSet("sun", J0, lat, lon, tz);
  // If local time < sunrise => use previous civil date's JD as the panchika-day base
  const localHour = now.getHours() + now.getMinutes()/60;
  const sunriseHourLocal = rsSun.rise!=null ? (rsSun.rise+12+tz) : 6;
  const usePrev = localHour < sunriseHourLocal;
  const Jp = usePrev ? (J0 - 1) : J0;

  // Recompute events on Panchika-day
  const rsS = riseSet("sun", Jp, lat, lon, tz);
  const rsM = riseSet("moon", Jp, lat, lon, tz);
  const sr = rsS.rise!=null ? to12(rsS.rise+12+tz) : "тАФ";
  const ss = rsS.set !=null ? to12(rsS.set +12+tz) : "тАФ";
  const mr = rsM.rise!=null ? to12(rsM.rise+12+tz) : "тАФ";
  const ms = rsM.set !=null ? to12(rsM.set +12+tz) : "тАФ";

  const t = tithiInfo(Jp + (localHour - tz)/24);
  const tEndHrs = (12*(1 - t.rem)) / (13.176358 - 0.98564736) * 24;
  const tEnd = to12(localHour + tEndHrs);
  const tNext = tithiName((t.num%30)+1);

  const nk = nakInfo(Jp + (localHour - tz)/24);
  const nEndHrs = ((13 + 20/60) * (1 - nk.frac)) / 13.176358 * 24;
  const nEnd = to12(localHour + nEndHrs);
  const nNext = NAK[(nk.idx+1)%27];
  const starLord = LORD[nk.name] || "тАФ";

  const bang = bangabdaFromSun(Jp + (localHour - tz)/24, tz, now);

  root().innerHTML = `
  <section class="card">
    <div class="title">ЁЯкФ ржкржЮрзНржЬрж┐ржХрж╛</div>
    <div class="small">рж╕рзВрж░рзНржпрж╕рж┐ржжрзНржзрж╛ржирзНржд ржЕржирзБрж╕рж╛рж░рзЗ ржЧржгржирж╛ (${city})</div>
    <div class="small">ржЖржЬ: ${bang.day} ${bang.month} ${bang.year} ржмржЩрзНржЧрж╛ржмрзНржж</div>

    <div class="pill">
      <div class="label">рждрж┐ржерж┐ <span class="badge" id="paksha">${t.paksha}</span></div>
      <div class="value" id="tithi">${tithiName(t.num)}</div>
      <div class="sub"><b>рж╢рзЗрж╖:</b> <span id="tEnd">${tEnd}</span> тАв <b>ржкрж░ржмрж░рзНрждрзА:</b> <span id="tNext">${tNext}</span></div>
    </div>

    <div class="pill">
      <div class="label">ржиржХрзНрж╖рждрзНрж░</div>
      <div class="value" id="nak">${nk.name}</div>
      <div class="starlord">ржЕржзрж┐ржкрждрж┐ ржЧрзНрж░рж╣: ${starLord}</div>
      <div class="sub"><b>рж╢рзЗрж╖:</b> <span id="nEnd">${nEnd}</span> тАв <b>ржкрж░ржмрж░рзНрждрзА:</b> <span id="nNext">${nNext}</span></div>
    </div>

    <div class="grid grid-2" style="margin-top:6px">
      ${rowTime("рж╕рзВрж░рзНржпрзЛржжржпрж╝","sr")}
      ${rowTime("рж╕рзВрж░рзНржпрж╛рж╕рзНржд","ss")}
      ${rowTime("ржЪржирзНржжрзНрж░рзЛржжржпрж╝","mr")}
      ${rowTime("ржЪржирзНржжрзНрж░рж╛рж╕рзНржд","ms")}
    </div>

    <div class="footer">ЁЯУН ${city} тАв Latitude ${lat.toFixed(2)}┬░, Longitude ${lon.toFixed(2)}┬░ тАв Local ${
      now.toLocaleTimeString('bn-BD',{hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:true})
    }</div>
  </section>

  <section class="tide">
    <div class="tgrid">
      <div class="tcell"><div class="tlab">ржЙржЪрзНржЪ ржЬрзЛржпрж╝рж╛рж░ рзз</div><div class="tval" id="tj1">12:20 PM</div></div>
      <div class="tcell"><div class="tlab">ржЙржЪрзНржЪ ржЬрзЛржпрж╝рж╛рж░ рзи</div><div class="tval" id="tj2">12:40 AM</div></div>
      <div class="tcell"><div class="tlab">ржирж┐ржорзНржи ржнрж╛ржЯрж╛ рзз</div><div class="tval" id="tv1">03:10 PM</div></div>
      <div class="tcell"><div class="tlab">ржирж┐ржорзНржи ржнрж╛ржЯрж╛ рзи</div><div class="tval" id="tv2">03:30 AM</div></div>
    </div>
    <div class="small">ЁЯМК Tide: placeholder (later replaceable)</div>
  </section>
  `;

  // place times
  setText('sr', sr); setText('ss', ss); setText('mr', mr); setText('ms', ms);
}
init();
</script>
</body>
</html>
