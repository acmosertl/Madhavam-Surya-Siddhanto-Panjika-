<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ЁЯкФ ржорж╛ржзржмржо ржкржЮрзНржЬрж┐ржХрж╛ тАФ Surya-Siddhanta vC5.4 (Auto Place)</title>
<style>
:root{--bg:#fff4e3;--card:#fff8ee;--pink:#f6a9d6;--label:#4527a0;--shadow:0 6px 16px rgba(0,0,0,.12);--ink:#2b237c;--blue1:#0b2257;--blue2:#183a8a}
body{margin:0;background:var(--bg);font-family:"Noto Sans Bengali","Noto Serif Bengali",system-ui,sans-serif;color:#1a1a1a}
.wrap{max-width:420px;margin:auto;padding:12px}
.card{background:var(--card);border-radius:18px;padding:14px;margin:10px;box-shadow:var(--shadow)}
.title{text-align:center;font-weight:900;font-size:22px;margin-bottom:6px}
.small{font-size:13px;opacity:.9;text-align:center;margin-bottom:6px}
.grid{display:grid;gap:10px}.grid-2{grid-template-columns:1fr 1fr}
.pill{background:var(--pink);border-radius:12px;padding:10px}
.label{color:var(--label);font-weight:900;font-size:15px}
.value{font-weight:900;font-size:26px;line-height:1.2;margin-top:2px}
.sub{font-size:14px;margin-top:2px}.sub b{font-weight:900}
.badge{display:inline-block;margin-left:6px;font-size:12px;padding:3px 8px;border-radius:999px;background:#ffe8a6;color:#7a5200;font-weight:900}
.starlord{font-size:14px;margin-top:4px;color:var(--ink);font-weight:800}
.footer{font-size:13px;text-align:center;margin-top:8px;opacity:.9}
.tide{background:linear-gradient(180deg,#183a8a,#0b2257);color:#fff;border-radius:16px;padding:12px;margin:10px}
.thead{font-weight:900;text-align:center;margin-bottom:6px}
.tgrid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.tcell{background:rgba(255,255,255,.1);padding:10px;border-radius:10px;text-align:center}
.tlab{font-weight:800}
.tval{font-weight:900;font-size:20px}
</style>
</head>
<body>
<div class="wrap" id="root">
  <div style="text-align:center;margin-top:40px;font-weight:700">ЁЯУН ржЕржмрж╕рзНржерж╛ржи ржирж┐рж░рзНржзрж╛рж░ржг ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ...</div>
</div>

<script>
/* -------- Bengali digit helpers -------- */
const EN="0123456789", BN="рзжрззрзирзйрзкрзлрзмрзнрзорзп";
const en2bn = s => String(s).replace(/[0-9]/g, d => BN[EN.indexOf(d)]);

/* -------- Location (GPS тЖТ ReverseGeocode тЖТ IP тЖТ Fallback) -------- */
const FALLBACK = {lat:22.5726, lon:88.3639, tz:(-new Date().getTimezoneOffset()/60), place:"ржХрж▓ржХрж╛рждрж╛, ржнрж╛рж░ржд", city:"ржХрж▓ржХрж╛рждрж╛"};
async function reverseGeocode(lat,lon){
  try{
    const r = await fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lon}&zoom=10`);
    const j = await r.json();
    if(j && j.address){
      const a=j.address;
      const city=a.city||a.town||a.village||a.county||a.state||"";
      const country=a.country||"";
      return {place: (city?city:"") + (country? (city?", ":"") + country:""), city: city||country||"Unknown"};
    }
  }catch{}
  return {place:"", city:""};
}
async function getLocation(){
  // Try GPS
  if(navigator.geolocation){
    const got = await new Promise(resolve=>{
      navigator.geolocation.getCurrentPosition(async p=>{
        const lat=p.coords.latitude, lon=p.coords.longitude;
        const geo=await reverseGeocode(lat,lon);
        resolve({lat,lon,tz:(-new Date().getTimezoneOffset()/60), place: geo.place||"GPS рж╕рзНржерж╛ржи", city: geo.city||"GPS"});
      }, ()=>resolve(null), {timeout:6000});
    });
    if(got) return got;
  }
  // Try IP
  try{
    const r=await fetch("https://ipapi.co/json/");
    const j=await r.json();
    if(j && j.latitude){
      const geo = await reverseGeocode(j.latitude, j.longitude);
      return {lat:j.latitude, lon:j.longitude, tz:(-new Date().getTimezoneOffset()/60), place: geo.place || (j.city?`${j.city}, ${j.country_name}`:"IP"), city: geo.city || j.city || "IP"};
    }
  }catch{}
  return FALLBACK;
}

/* -------- Astro Core (Surya-Siddhanta style) -------- */
const D2R=Math.PI/180,R2D=180/Math.PI; const norm=x=>((x%360)+360)%360;
function JD(y,m,d,ut=0){ if(m<=2){y--;m+=12;} const A=Math.floor(y/100),B=2-A+Math.floor(A/4);
  return Math.floor(365.25*(y+4716))+Math.floor(30.6001*(m+1))+d+B-1524.5+ut/24;}
function obliq(T){ return 23.439291-0.0130042*T; }
function gmst(J){ const T=(J-2451545)/36525; return norm(280.46061837+360.98564736629*(J-2451545)+0.000387933*T*T - T*T*T/38710000); }
function sunLong(J){ const d=J-2451545; const M=norm(357.52911+0.98560028*d);
  return norm(280.46646+0.98564736*d + 1.9146*Math.sin(M*D2R)+0.02*Math.sin(2*M*D2R)); }
function moonLong(J){ const d=J-2451545;
  const Lm=norm(218.3165+13.176358*d), D=norm(297.8501921+12.19074912*d), Ms=norm(357.5291092+0.98560028*d), Mm=norm(134.9633964+13.06499295*d);
  return norm(Lm + 6.289*Math.sin(Mm*D2R) + 1.274*Math.sin((2*D-Mm)*D2R) + 0.658*Math.sin(2*D*D2R) - 0.186*Math.sin(Ms*D2R));
}
function eclToEq(l,J){ const eps=obliq((J-2451545)/36525)*D2R, L=l*D2R;
  return { ra: norm(Math.atan2(Math.sin(L)*Math.cos(eps),Math.cos(L))*R2D)/15, dec: Math.asin(Math.sin(eps)*Math.sin(L))*R2D };
}
function hourAngle(J,ra,lat,lon,tz){ const lst=(gmst(J)/15 + tz + lon/15); let H=(lst-ra)*15; return ((H+540)%360)-180; }
function altitude(dec,H,lat){ return Math.asin(Math.sin(lat*D2R)*Math.sin(dec*D2R)+Math.cos(lat*D2R)*Math.cos(dec*D2R)*Math.cos(H*D2R))*R2D; }
function riseSet(body,J0,lat,lon,tz){ let rise=null,setv=null;
  for(let h=-14;h<14;h++){
    const J1=J0+(h-0.5-tz)/24, J2=J0+(h+0.5-tz)/24;
    const L1=(body==="sun")?sunLong(J1):moonLong(J1), L2=(body==="sun")?sunLong(J2):moonLong(J2);
    const q1=eclToEq(L1,J1), q2=eclToEq(L2,J2);
    const a1=altitude(q1.dec, hourAngle(J1,q1.ra,lat,lon,tz), lat);
    const a2=altitude(q2.dec, hourAngle(J2,q2.ra,lat,lon,tz), lat);
    if(a1<0 && a2>0 && rise===null) { const t=-a1/(a2-a1); rise=(h-0.5)+t; }
    if(a1>0 && a2<0 && setv===null) { const t= a1/(a1-a2); setv=(h-0.5)+t; }
  }
  return {rise,set:setv};
}
const to12=h=>{ if(h==null||isNaN(h))return "тАФ"; h=(h+24)%24; const ap=h>=12?"PM":"AM";
  let hh=Math.floor(h%12); if(hh===0)hh=12; const mm=Math.round((h%1)*60);
  return `${en2bn(hh)}:${en2bn(String(mm).padStart(2,"0"))} ${ap==="AM"?"ржПржПржо":"ржкрж┐ржПржо"}`; };

/* -------- Tithi / Nakshatra / Paksha -------- */
function tithiName(n){
  const a=["ржкрзНрж░рждрж┐ржкржж","ржжрзНржмрж┐рждрзАрзЯрж╛","рждрзГрждрзАрзЯрж╛","ржЪрждрзБрж░рзНржерзА","ржкржЮрзНржЪржорзА","рж╖рж╖рзНржарзА","рж╕ржкрзНрждржорзА","ржЕрж╖рзНржЯржорзА","ржиржмржорзА","ржжрж╢ржорзА","ржПржХрж╛ржжрж╢рзА","ржжрзНржмрж╛ржжрж╢рзА","рждрзНрж░ржпрж╝рзЛржжрж╢рзА","ржЪрждрзБрж░рзНржжрж╢рзА","ржкрзВрж░рзНржгрж┐ржорж╛","ржкрзНрж░рждрж┐ржкржж","ржжрзНржмрж┐рждрзАрзЯрж╛","рждрзГрждрзАрзЯрж╛","ржЪрждрзБрж░рзНржерзА","ржкржЮрзНржЪржорзА","рж╖рж╖рзНржарзА","рж╕ржкрзНрждржорзА","ржЕрж╖рзНржЯржорзА","ржиржмржорзА","ржжрж╢ржорзА","ржПржХрж╛ржжрж╢рзА","ржжрзНржмрж╛ржжрж╢рзА","рждрзНрж░ржпрж╝рзЛржжрж╢рзА","ржЪрждрзБрж░рзНржжрж╢рзА","ржЕржорж╛ржмрж╕рзНржпрж╛"];
  return a[(n-1)%30];
}
const NAK=["ржЕрж╢рзНржмрж┐ржирзА","ржнрж░ржгрзА","ржХрзГрждрзНрждрж┐ржХрж╛","рж░рзЛрж╣рж┐ржгрзА","ржорзГржЧрж╢рж┐рж░рж╛","ржЖржжрзНрж░рж╛","ржкрзБржирж░рзНржмрж╕рзВ","ржкрзБрж╖рзНржпрж╛","ржЖрж╢рзНрж▓рзЗрж╖рж╛","ржоржШрж╛","ржкрзВрж░рзНржмржлрж╛рж▓рзНржЧрзБржирзА","ржЙрждрзНрждрж░ржлрж╛рж▓рзНржЧрзБржирзА","рж╣рж╕рзНрждрж╛","ржЪрж┐рждрзНрж░рж╛","рж╕рзНржмрж╛рждрзА","ржмрж┐рж╢рж╛ржЦрж╛","ржЕржирзБрж░рж╛ржзрж╛","ржЬрзНржпрзЗрж╖рзНржарж╛","ржорзВрж▓рж╛","ржкрзВрж░рзНржмрж╛рж╖рж╛рзЭрж╛","ржЙрждрзНрждрж░рж╛рж╖рж╛рзЭрж╛","рж╢рзНрж░ржмржгрж╛","ржзржирж┐рж╖рзНржарж╛","рж╢рждржнрж┐рж╖рж╛","ржкрзВрж░рзНржмржнрж╛ржжрзНрж░ржкржж","ржЙрждрзНрждрж░ржнрж╛ржжрзНрж░ржкржж","рж░рзЗржмрждрзА"];
const LORD={"ржЕрж╢рзНржмрж┐ржирзА":"ржХрзЗрждрзБ (Ketu)","ржнрж░ржгрзА":"рж╢рзБржХрзНрж░ (Venus)","ржХрзГрждрзНрждрж┐ржХрж╛":"рж╕рзВрж░рзНржп (Sun)","рж░рзЛрж╣рж┐ржгрзА":"ржЪржирзНржжрзНрж░ (Moon)","ржорзГржЧрж╢рж┐рж░рж╛":"ржоржЩрзНржЧрж▓ (Mars)","ржЖржжрзНрж░рж╛":"рж░рж╛рж╣рзБ (Rahu)","ржкрзБржирж░рзНржмрж╕рзВ":"ржмрзГрж╣рж╕рзНржкрждрж┐ (Jupiter)","ржкрзБрж╖рзНржпрж╛":"рж╢ржирж┐ (Saturn)","ржЖрж╢рзНрж▓рзЗрж╖рж╛":"ржмрзБржз (Mercury)","ржоржШрж╛":"ржХрзЗрждрзБ (Ketu)","ржкрзВрж░рзНржмржлрж╛рж▓рзНржЧрзБржирзА":"рж╢рзБржХрзНрж░ (Venus)","ржЙрждрзНрждрж░ржлрж╛рж▓рзНржЧрзБржирзА":"рж╕рзВрж░рзНржп (Sun)","рж╣рж╕рзНрждрж╛":"ржЪржирзНржжрзНрж░ (Moon)","ржЪрж┐рждрзНрж░рж╛":"ржоржЩрзНржЧрж▓ (Mars)","рж╕рзНржмрж╛рждрзА":"рж░рж╛рж╣рзБ (Rahu)","ржмрж┐рж╢рж╛ржЦрж╛":"ржмрзГрж╣рж╕рзНржкрждрж┐ (Jupiter)","ржЕржирзБрж░рж╛ржзрж╛":"рж╢ржирж┐ (Saturn)","ржЬрзНржпрзЗрж╖рзНржарж╛":"ржмрзБржз (Mercury)","ржорзВрж▓рж╛":"ржХрзЗрждрзБ (Ketu)","ржкрзВрж░рзНржмрж╛рж╖рж╛рзЭрж╛":"рж╢рзБржХрзНрж░ (Venus)","ржЙрждрзНрждрж░рж╛рж╖рж╛рзЭрж╛":"рж╕рзВрж░рзНржп (Sun)","рж╢рзНрж░ржмржгрж╛":"ржЪржирзНржжрзНрж░ (Moon)","ржзржирж┐рж╖рзНржарж╛":"ржоржЩрзНржЧрж▓ (Mars)","рж╢рждржнрж┐рж╖рж╛":"рж░рж╛рж╣рзБ (Rahu)","ржкрзВрж░рзНржмржнрж╛ржжрзНрж░ржкржж":"ржмрзГрж╣рж╕рзНржкрждрж┐ (Jupiter)","ржЙрждрзНрждрж░ржнрж╛ржжрзНрж░ржкржж":"рж╢ржирж┐ (Saturn)","рж░рзЗржмрждрзА":"ржмрзБржз (Mercury)"};
function tithiInfo(J){ const ls=sunLong(J), lm=moonLong(J); const diff=norm(lm-ls); const num=Math.floor(diff/12)+1; const rem=(diff%12)/12; const paksha=(num<=15)?"рж╢рзБржХрзНрж▓ржкржХрзНрж╖":"ржХрзГрж╖рзНржгржкржХрзНрж╖"; return {num,rem,paksha}; }
function nakInfo(J){ const lm=moonLong(J), step=(13 + 20/60); const idx=Math.floor(lm/step); const frac=(lm%step)/step; return {idx,frac,name:NAK[idx]}; }

/* -------- Bangabda (sidereal solar, sunrise-based) -------- */
function lahiriAyanamsa(J){ const T=(J-2451545)/36525; return 24.0 + 0.0*T; } // simple near-2025
const B_MONTHS=["ржмрзИрж╢рж╛ржЦ","ржЬрзНржпрзИрж╖рзНржа","ржЖрж╖рж╛рзЭ","рж╢рзНрж░рж╛ржмржг","ржнрж╛ржжрзНрж░","ржЖрж╢рзНржмрж┐ржи","ржХрж╛рж░рзНрждрж┐ржХ","ржЕржЧрзНрж░рж╣рж╛рзЯржг","ржкрзМрж╖","ржорж╛ржШ","ржлрж╛рж▓рзНржЧрзБржи","ржЪрзИрждрзНрж░"];
function bangabdaFromSun(J, localDate){
  const ay=lahiriAyanamsa(J); const lon=norm(sunLong(J)-ay); const sign=Math.floor(lon/30); const dayInMonth=Math.floor(lon%30)+1;
  const poila=new Date(localDate.getFullYear(),3,14); // Apr 14 WB
  const byear = (localDate>=poila)? (localDate.getFullYear()-593):(localDate.getFullYear()-594);
  return {month:B_MONTHS[sign], day:dayInMonth, year:byear};
}

/* -------- Tide (location-based phase approx) -------- */
function tideApproxWithLon(date, lon){
  // M2 tide 12.42h period; phase offset by longitude (тЙИ 1h per 15┬░)
  const base = new Date(date.getFullYear(),date.getMonth(),date.getDate());
  const hrsOffset = (lon/15); // local phase shift
  const firstHigh = (5 + hrsOffset + 12.42*((date-base)/ (12.42*3600*1000)) )%12.42; // around morning
  const high1 = (5 + hrsOffset)%24;
  const high2 = (high1 + 12.42)%24;
  const low1  = (high1 + 6.21)%24;
  const low2  = (high2 + 6.21)%24;
  return {high1, high2, low1, low2};
}

/* -------- Render -------- */
const root=()=>document.getElementById("root");
const rowTime=(label,id)=>`<div class="pill"><div class="label">${label}</div><div class="value" id="${id}">тАФ</div></div>`;
function setText(id,v){ const el=document.getElementById(id); if(el) el.textContent=v; }

(async function init(){
  const loc = await getLocation();
  const {lat,lon,tz,place,city} = loc;

  const now = new Date();
  const Y=now.getFullYear(), M=now.getMonth()+1, D=now.getDate();
  const J0 = JD(Y,M,D,0);
  const rsSun0 = riseSet("sun", J0, lat, lon, tz);
  const localHour = now.getHours() + now.getMinutes()/60;
  const sunriseLocal = rsSun0.rise!=null ? (rsSun0.rise+12+tz) : 6;
  const Jp = (localHour < sunriseLocal) ? (J0-1) : J0;

  const rsS = riseSet("sun", Jp, lat, lon, tz);
  const rsM = riseSet("moon", Jp, lat, lon, tz);
  const sr = rsS.rise!=null ? to12(rsS.rise+12+tz) : "тАФ";
  const ss = rsS.set !=null ? to12(rsS.set +12+tz) : "тАФ";
  const mr = rsM.rise!=null ? to12(rsM.rise+12+tz) : "тАФ";
  const ms = rsM.set !=null ? to12(rsM.set +12+tz) : "тАФ";

  const hourNow = now.getHours() + now.getMinutes()/60;
  const t = tithiInfo(Jp + (hourNow - tz)/24);
  const tEndHrs = (12*(1 - t.rem)) / (13.176358 - 0.98564736) * 24;
  const tEnd = to12(hourNow + tEndHrs);
  const tNext = tithiName((t.num%30)+1);

  const nk = nakInfo(Jp + (hourNow - tz)/24);
  const nEndHrs = ((13 + 20/60) * (1 - nk.frac)) / 13.176358 * 24;
  const nEnd = to12(hourNow + nEndHrs);
  const nNext = NAK[(nk.idx+1)%27];
  const starLord = LORD[nk.name] || "тАФ";

  const bang = bangabdaFromSun(Jp + (hourNow - tz)/24, now);

  const tide = tideApproxWithLon(now, lon);

  root().innerHTML = `
  <section class="card">
    <div class="title">ЁЯкФ ржкржЮрзНржЬрж┐ржХрж╛</div>
    <div class="small">рж╕рзВрж░рзНржпрж╕рж┐ржжрзНржзрж╛ржирзНржд ржЕржирзБрж╕рж╛рж░рзЗ ржЧржгржирж╛</div>
    <div class="small">ржЖржЬ: ${en2bn(bang.day)} ${bang.month} ${en2bn(bang.year)} ржмржЩрзНржЧрж╛ржмрзНржж</div>
    <div class="small">ЁЯУН ${place || city}</div>

    <div class="pill">
      <div class="label">рждрж┐ржерж┐ <span class="badge">${t.paksha}</span></div>
      <div class="value">${tithiName(t.num)}</div>
      <div class="sub"><b>рж╢рзЗрж╖:</b> ${tEnd} тАв <b>ржкрж░ржмрж░рзНрждрзА:</b> ${tNext}</div>
    </div>

    <div class="pill">
      <div class="label">ржиржХрзНрж╖рждрзНрж░</div>
      <div class="value">${nk.name}</div>
      <div class="starlord">ржЕржзрж┐ржкрждрж┐ ржЧрзНрж░рж╣: ${starLord}</div>
      <div class="sub"><b>рж╢рзЗрж╖:</b> ${nEnd} тАв <b>ржкрж░ржмрж░рзНрждрзА:</b> ${nNext}</div>
    </div>

    <div class="grid grid-2" style="margin-top:6px">
      ${rowTime("рж╕рзВрж░рзНржпрзЛржжржпрж╝","sr")}
      ${rowTime("рж╕рзВрж░рзНржпрж╛рж╕рзНржд","ss")}
      ${rowTime("ржЪржирзНржжрзНрж░рзЛржжржпрж╝","mr")}
      ${rowTime("ржЪржирзНржжрзНрж░рж╛рж╕рзНржд","ms")}
    </div>

    <div class="small">${new Intl.DateTimeFormat('bn-BD',{hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:true,timeZoneName:'short'}).format(now)}</div>
    <div class="small">Latitude ${en2bn(lat.toFixed(2))}┬░, Longitude ${en2bn(lon.toFixed(2))}┬░</div>
  </section>

  <section class="tide">
    <div class="thead">ЁЯМК ржЖржЬржХрзЗрж░ ржЬрзЛржпрж╝рж╛рж░-ржнрж╛ржЯрж╛ (ржЖржирзБржорж╛ржирж┐ржХ, рж▓рзЛржХрзЗрж╢ржиржнрж┐рждрзНрждрж┐ржХ)</div>
    <div class="tgrid">
      <div class="tcell"><div class="tlab">ржЙржЪрзНржЪ ржЬрзЛржпрж╝рж╛рж░ рзз</div><div class="tval">${to12(tide.high1)}</div></div>
      <div class="tcell"><div class="tlab">ржЙржЪрзНржЪ ржЬрзЛржпрж╝рж╛рж░ рзи</div><div class="tval">${to12(tide.high2)}</div></div>
      <div class="tcell"><div class="tlab">ржирж┐ржорзНржи ржнрж╛ржЯрж╛ рзз</div><div class="tval">${to12(tide.low1)}</div></div>
      <div class="tcell"><div class="tlab">ржирж┐ржорзНржи ржнрж╛ржЯрж╛ рзи</div><div class="tval">${to12(tide.low2)}</div></div>
    </div>
  </section>
  `;

  // place times
  setText('sr', sr); setText('ss', ss); setText('mr', mr); setText('ms', ms);
})();
</script>
</body>
</html>
